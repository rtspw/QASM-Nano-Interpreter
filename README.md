# QASM (Minus) Interpreter

An interpreter for a small subset of QASM written in Typescript. The parser is generated by ANTLR.

Supported instructions are:
- `x`: X Gate
- `h`: Hadamard Gate
- `t`: T Gate
- `tdg`: Hermetian adjoint of T Gate

Example QASM files are given in the `examples/` folder.

## How to Run

NodeJS is required to run the interpreter.

Run:
```bash
npm install
```
To run the program, run:
```bash
# Run the REPL
node build/index.js

# Run a source code file
node build/index.js -f <filename>
```

```
Options:
      --version  Show version number
  -f, --file     QASM file to run and interpret
  -v, --verbose  Output state and operation of each step in simulation
  -m, --metrics  Whether to run metrics on execution of QASM code
  -c, --color    Whether to include ansi colors in log output
  -h, --help     Show help
```

### Running the REPL

If no "file" argument is given, the program will start in REPL mode.

```
node ./build/index.js
QASM-- Interpreter REPL
Type :quit, :exit, or SIGINT to quit
Type :help for help

How many qubits? 7

1|0000000⟩
> x q[0];

1|1000000⟩
> h q[0];

0.7071067812|0000000⟩ + (-0.7071067812)|1000000⟩
> cx q[0], q[1];

0.7071067812|0000000⟩ + (-0.7071067812)|1100000⟩
> 
```

Possible metacommands within the REPL:
```
:help: See the help menu
:quit: Exit program
:exit: Exit program
:reset: Resets qubit state
:reset+: Resets qubit state with different number of qubits
```

Enabling the `metrics` flag will print the total runtime between each performed operation.

### Running a File

We can also run source code from a file.

For example, we can run `examples/test1.qasm` and view the final state.

```
node ./build/index.js -f examples/test1.qasm
Final state: 0.5|0000⟩ + 0.5|0100⟩ + 0.5|1000⟩ + (-0.5)|1100⟩
```

If we enable verbose mode and metrics, it will also print the state at each operation and metrics afterwords with the total parsing and runtime, and the count and average runtime for each operation type.

```
node ./build/index.js -mvf examples/test1.qasm
INFO || Circuit has 4 qubits and 4 cbits
INFO || State: 1|0000⟩
INFO || Operation: h q[0]
INFO || State: 0.7071067812|0000⟩ + 0.7071067812|1000⟩
INFO || Operation: cx q[0], q[1]
INFO || State: 0.7071067812|0000⟩ + 0.7071067812|1100⟩
INFO || Operation: h q[1]
INFO || State: 0.5|0000⟩ + 0.5|0100⟩ + 0.5|1000⟩ + (-0.5)|1100⟩
INFO || Operation: h q[0]
INFO || State: 0.7071067812|0000⟩ + 0.7071067812|1100⟩
INFO || Operation: h q[1]
Final state: 0.5|0000⟩ + 0.5|0100⟩ + 0.5|1000⟩ + (-0.5)|1100⟩

Total Parsing Time: 22.394ms
Total Execution Time: 4.056ms
Number of Operations: 5 ops
Opname  | Count
  cx    | 1
  h     | 4
Average Time Per Operation: 0.8112ms
Opname  | Average Time (ms)
  cx    | 0.16300
  h     | 0.36350
  ```

### Performance Testing

Two additional scripts will also be generated:
- `build/run-examples.js`: Runs all test files under `examples/` and prints the results and metrics.
- `build/run-performance-test.js`: Runs stress tests for different number of qubits and randomly generated instructions, and generates plots for the results.

## Build Instructions

### Grammar

Java is required to run ANTLR.

The grammar is defined in `src/grammar/QASM.g4`.

To run ANTLR and generate the target TS files, run `npm run antlr`.

### Interpreter

The interpreter can be built by running `npm run build`.

For development, use `npm run dev` which will rebuild on any file changes.

- `src/runtime` contains high level code for the interpreter and REPL. The internal qubit state representation is located in `src/runtime/qubit-state.ts`.
- `src/grammar` contains files for the lexer and parser. All files there are generated by ANTLR except for `QASM.g4`.
- `src/visitors` contains multiple utility visitors for navigating the AST. The most important is the `RunnerVisitor.ts`, which takes an initial QubitState and runs each operation on it, returning the final state.
- `src/index.ts` is the entry with command line argument parsing and spinning up the runtime. 
